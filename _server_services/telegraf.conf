[agent]
  interval = "10s"
  flush_interval = "10s"
  omit_hostname = true

[[inputs.http_listener_v2]]
  service_address = ":8081"
  basic_username = "crss"
  basic_password = "xR7!qL2vP9@tW8zB"
  methods = ["POST"]
  paths = ["/crss", "/load_status"]
  data_format = "json_v2"

  [[inputs.http_listener_v2.json_v2]]
    measurement_name = "device_metrics"
    timestamp_path   = "ts"            # root-level ts
    timestamp_format = "unix"          # ts is a unix timestamp

    # device_id becomes a tag
    [[inputs.http_listener_v2.json_v2.tag]]
      path   = "device_id"
      rename = "device_id"
      type   = "string"

    # basic fields
    [[inputs.http_listener_v2.json_v2.field]]
      path   = "signal"
      rename = "signal"
      type   = "float"
      optional = true

    [[inputs.http_listener_v2.json_v2.field]]
      path   = "total_wake_time"
      rename = "total_wake_time"
      type   = "float"
      optional = true

    [[inputs.http_listener_v2.json_v2.field]]
      path   = "load_status"
      rename = "load_status"
      type   = "int"
      optional = true

    # registers
    [[inputs.http_listener_v2.json_v2.field]]
      path   = "registers.0x3108"
      rename = "battery_voltage_v"
      type   = "float"
      optional = true

    [[inputs.http_listener_v2.json_v2.field]]
      path   = "registers.0x3109"
      rename = "battery_output_current_a"
      type   = "float"
      optional = true

    [[inputs.http_listener_v2.json_v2.field]]
      path   = "registers.0x310A"
      rename = "battery_output_power_w"
      type   = "float"
      optional = true

    [[inputs.http_listener_v2.json_v2.field]]
      path   = "registers.0x310C"
      rename = "load_output_voltage_v"
      type   = "float"
      optional = true

    [[inputs.http_listener_v2.json_v2.field]]
      path   = "registers.0x310D"
      rename = "load_output_current_a"
      type   = "float"
      optional = true

    [[inputs.http_listener_v2.json_v2.field]]
      path   = "registers.0x310E"
      rename = "load_output_power_w"
      type   = "float"
      optional = true

    [[inputs.http_listener_v2.json_v2.field]]
      path   = "registers.0x3110"
      rename = "remote_battery_temp_c"
      type   = "float"
      optional = true

    [[inputs.http_listener_v2.json_v2.field]]
      path   = "registers.0x3111"
      rename = "equipment_temp_c"
      type   = "float"
      optional = true

    [[inputs.http_listener_v2.json_v2.field]]
      path   = "registers.0x3112"
      rename = "mosfet_temp_c"
      type   = "float"
      optional = true

    [[inputs.http_listener_v2.json_v2.field]]
      path   = "registers.0x311A"
      rename = "battery_soc_percent"
      type   = "float"
      optional = true

    [[inputs.http_listener_v2.json_v2.field]]
      path   = "registers.0x3300"
      rename = "max_pv_volt_today_v"
      type   = "float"
      optional = true

    [[inputs.http_listener_v2.json_v2.field]]
      path   = "registers.0x3301"
      rename = "min_pv_volt_today_v"
      type   = "float"
      optional = true

    [[inputs.http_listener_v2.json_v2.field]]
      path   = "registers.0x3302"
      rename = "max_batt_volt_today_v"
      type   = "float"
      optional = true

    [[inputs.http_listener_v2.json_v2.field]]
      path   = "registers.0x3303"
      rename = "min_batt_volt_today_v"
      type   = "float"
      optional = true

    [[inputs.http_listener_v2.json_v2.field]]
      path   = "registers.0x3304"
      rename = "consumed_energy_today_kwh"
      type   = "float"
      optional = true

    [[inputs.http_listener_v2.json_v2.field]]
      path   = "registers.0x3306"
      rename = "consumed_energy_month_kwh"
      type   = "float"
      optional = true

    [[inputs.http_listener_v2.json_v2.field]]
      path   = "registers.0x3308"
      rename = "consumed_energy_year_kwh"
      type   = "float"
      optional = true

    [[inputs.http_listener_v2.json_v2.field]]
      path   = "registers.0x330A"
      rename = "total_consumed_energy_kwh"
      type   = "float"
      optional = true

    [[inputs.http_listener_v2.json_v2.field]]
      path   = "registers.0x330C"
      rename = "generated_energy_today_kwh"
      type   = "float"
      optional = true

    [[inputs.http_listener_v2.json_v2.field]]
      path   = "registers.0x330E"
      rename = "generated_energy_month_kwh"
      type   = "float"
      optional = true

    [[inputs.http_listener_v2.json_v2.field]]
      path   = "registers.0x3310"
      rename = "generated_energy_year_kwh"
      type   = "float"
      optional = true

    [[inputs.http_listener_v2.json_v2.field]]
      path   = "registers.0x3312"
      rename = "total_generated_energy_kwh"
      type   = "float"
      optional = true

    [[inputs.http_listener_v2.json_v2.field]]
      path   = "registers.0x331B"
      rename = "battery_current_a"
      type   = "float"
      optional = true


[[outputs.influxdb_v2]]
  urls = ["http://influxdb3-core:8181"]
  token = "apiv3_lFm63XUK94ceUmE216wwPlktMwuTFJJO9qKAc8HGFA-MQb5LdhqAarjoXVI0bi8sk5qmfYhNWWephZeW9IMTtg"
  organization = "igerko-org"
  bucket = "igerko-bucket"